{% extends 'base.html' %}
{% load static %}
{% block body %}
<div class="profile" align="center" style="padding-top:-10%">
    <label><h2>Список назначенных заявок</h2></label><br>
    {% if apps|length == 0 %}
       <label><h3>Не было подано ни одной заявки</h3></label>
    {% else %}
      <table class="table_crit">
        <thead>
            <form method="GET">
                {% csrf_token %}
                <tr>
            <th>ФИО<br>
              <div id="zatemnenie_search_fio">
                  <div id="okno_search_fio">
                    <center>Поиск по ФИО</center>
                        <table class="table_crit">
                            <thead>
                                <tr>
                                    <th>Параметр</th>
                                    <th>Значение</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Фамилия</td>
                                    <td>
                                        <input type="text" class="form-control" name="surname">
                                    </td>
                                </tr>
                                <tr>
                                    <td>Имя</td>
                                    <td>
                                        <input type="text" class="form-control" name="name">
                                    </td>
                                </tr>
                                <tr>
                                    <td>Отчество</td>
                                    <td>
                                        <input type="text" class="form-control" name="patronymic">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div style="width: 30%; margin: 0 auto;">
                            <button class="w-100 btn btn-lg btn-primary" type="submit">
                              Поиск
                            </button>
                        </div>
                    <a href="#" class="close">Закрыть окно</a>
                  </div>
                </div>
                <a href="#zatemnenie_search_fio">
                      <img src="{% static 'work/discover.png' %}" height="25px" width="25px"></a>
              </th>
                <th>МО<br>
                  <div id="zatemnenie_app_mo">
                    <div id="okno_app_mo">
                      Выберите нужное МО:
                        <select size="10" name="filter_mo" style="width:100%; text-align: center">
                          {% for el in filter.mo %}
                            <option>{{ el }}</option>
                          {% endfor %}
                        </select>
                        <button class="w-100 btn btn-lg btn-primary" type="submit">
                          Применить фильтр
                        </button>
                      <a href="#" class="close">Закрыть окно</a>
                    </div>
                  </div>
                  <a href="#zatemnenie_app_mo">
                <img src="{% static 'work/filter.png' %}" height="25px" width="25px"></a></th>
                <th>ОО<br>
                  <div id="zatemnenie_search_oo">
                      <div id="okno_search_oo">
                        <center>Поиск по ОО</center>
                            <table class="table_crit">
                                <thead>
                                    <tr>
                                        <th>Параметр</th>
                                        <th>Значение</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Название ОО</td>
                                        <td>
                                            <input type="text" class="form-control" name="oo">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div style="width: 30%; margin: 0 auto;">
                                <button class="w-100 btn btn-lg btn-primary" type="submit">
                                  Поиск
                                </button>
                            </div>
                        <a href="#" class="close">Закрыть окно</a>
                      </div>
                    </div>
                    <a href="#zatemnenie_search_oo">
                          <img src="{% static 'work/discover.png' %}" height="25px" width="25px"></a>
                </th>
                <th>Предметная область<br>
                  <div id="zatemnenie_app_subj">
                      <div id="okno_app_subj">
                          Выберите нужную предметную область:
                              <select size="10" name="filter_subj" style="width:100%; text-align: center">
                                  {% for el in filter.subj %}
                                      <option>{{ el }}</option>
                                  {% endfor %}
                              </select>
                              <button class="w-100 btn btn-lg btn-primary" type="submit">
                                  Применить фильтр
                              </button>
                          <a href="#" class="close">Закрыть окно</a>
                      </div>
                  </div>
                  <a href="#zatemnenie_app_subj">
                      <img src="{% static 'work/filter.png' %}" height="25px" width="25px"></a>
                </th>
                <th>Должность<br>
                  <div id="zatemnenie_pos">
                    <div id="okno_pos">
                        Выберите нужную должность:
                            <select size="10" name="filter_pos" style="width:100%; text-align: center">
                                {% for el in filter.pos %}
                                    <option>{{ el }}</option>
                                {% endfor %}
                            </select>
                            <button class="w-100 btn btn-lg btn-primary" type="submit">
                                Применить фильтр
                            </button>
                        <a href="#" class="close">Закрыть окно</a>
                    </div>
                </div>
                <a href="#zatemnenie_pos">
                    <img src="{% static 'work/filter.png' %}" height="25px" width="25px"></a>
                </th>
                <th>Текущая категория<br>
                  <div id="zatemnenie_havecat">
                    <div id="okno_havecat">
                        <div id="inwindow_havecat">
                            Выберите нужную текущую категорию:
                            <select size="10" name="filter_havecat" style="width:100%; text-align: center">
                                {% for el in filter.have_cat %}
                                    <option>{{ el }}</option>
                                {% endfor %}
                            </select>
                            <button class="w-100 btn btn-lg btn-primary" type="submit">
                                Применить фильтр
                            </button>
                            <a href="#" class="close">Закрыть окно</a>
                        </div>
                    </div>
                </div>
                <a href="#zatemnenie_havecat">
                    <img src="{% static 'work/filter.png' %}" height="25px" width="25px"></a>
                </th>
                <th>Заявленная категория<br>
                  <div id="zatemnenie_deccat">
                    <div id="okno_deccat">
                        Выберите нужную заявленную категорию:
                            <select size="10" name="filter_deccat" style="width:100%; text-align: center">
                                {% for el in filter.dec_cat %}
                                    <option>{{ el }}</option>
                                {% endfor %}
                            </select>
                            <button class="w-100 btn btn-lg btn-primary" type="submit">
                                Применить фильтр
                            </button>
                        <a href="#" class="close">Закрыть окно</a>
                    </div>
                </div>
                <a href="#zatemnenie_deccat">
                    <img src="{% static 'work/filter.png' %}" height="25px" width="25px"></a>
                </th>
                <th>Экспертиза</th>
              </tr>
                <input type="hidden" value="{{ period }}" name="period">
            </form>
        </thead>
        <tbody>
          {% for el in apps|slice:":15" %}
            <tr>
              <td>
                {{ el.user_profile.surname }} {{ el.user_profile.name }}<br>
                  {{ el.user_profile.patronymic }}
              </td>
              <td>
                {{ el.user_profile.mo }}
              </td>
              <td>
                {{ el.oo }}
              </td>
              <td>
                {{ el.subj_area }}
              </td>
              <td>
                {{ el.pos }}
              </td>
              <td>
                {% if el.cat_have is None %}
                  Нет
                {% else %}
                  {{ el.cat_have }}
                {% endif %}
              </td>
              <td>
                {{ el.dec_cat }}
              </td>
              <td>Результат:<br>
                  {% for res in el.get_expertres%}
                    {% if res.expert.snils == request.user.username %}
                      {% if res.result == 'Установить' %}
                        <b style="color: #22b840">Установить</b>
                      {% else %}
                        <b style="color: #f15b4e">Отказать</b>
                      {% endif %}
                  {% else %}
                    <b>Нет результата</b>
                  {% endif %}
                  {% endfor %}
                <br><button class="w-100 btn btn-lg btn-primary"
                          onclick="window.location.href = '{% url 'expert:app_expertise' el.id %}';">
                    Перейти к экспертизе
                </button>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
    {% if rejection_app is not None%}
     <div class="tn-box tn-box-color-2" style="background:#226440">
        <p>Заявка успешно отозвана!</p>
       <div class="tn-progress"></div>
     </div>
    {% endif %}
</div>
{% endblock %}